@using CafeApp.Business.Helpers.Dtos
@using CafeApp.Business.Interfaces
@using CafeApp.Domain.Interfaces
@inject IApplicationUnit _unit;
@inject NavigationManager _navigation;
@inject INotification _notification;
@page "/dashboard/tables/new"
@page "/dashboard/tables/{id}"

<MudCard>
    <MudForm Model="@_model" @ref="@_form">
        <MudCardContent>
            <MudTextField @bind-Value="_model.Title"
            For="@(() => _model.Title)"
            Immediate="true"
            Label="عنوان" />

            <MudCheckBox @bind-Value="_model.IsActive"
            For="@(() => _model.IsActive)"
            Immediate="true"
            Label="وضعیت" />


        </MudCardContent>
        <MudCardContent Class="pa-0">



        </MudCardContent>
    </MudForm>
    <MudCardActions>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" OnClick="@(async () => await Submit())">ثبت</MudButton>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" OnClick=Cancel>لغو</MudButton>

    </MudCardActions>
</MudCard>

@code {
    [Parameter]
    public Guid Id { get; set; }

    private MudForm _form;
    private TableDto _model = new TableDto();

    protected override async Task OnInitializedAsync()
    {
        if (Id is Guid id && id!=Guid.Empty)
            _model = await _unit.Tables.GetById(id);
        base.OnInitialized();
    }

    public async Task Submit()
    {
        CreateTableParameter parameter = new CreateTableParameter();
        parameter = new CreateTableParameter { Title = _model.Title, IsActive = _model.IsActive };
        await _unit.Tables.CreateAsync(parameter);
        _notification.NotifySuccess();

    }
    public void Cancel()
    {
        _navigation.NavigateTo("/dashboard/tables");
    }

   
}
